<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Safety Law Tracker</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:24px;}
    header{display:flex; gap:12px; align-items:baseline; flex-wrap:wrap;}
    small{color:#666;}
    .card{border:1px solid #ddd; border-radius:12px; padding:14px; margin:12px 0;}
    .tag{display:inline-block; padding:2px 8px; border:1px solid #ccc; border-radius:999px; font-size:12px; margin-left:8px;}
    a{color:#0b57d0;}
  </style>
</head>
<body>
  <header>
    <h1>Safety Law Tracker</h1>
    <small>データはGitHub Actionsで自動更新</small>
    <a href="./data/revisions.json" target="_blank" rel="noreferrer">JSONを見る</a>
  </header>

  <div id="status"></div>
  <div id="list"></div>

  <script>
    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("list");

    async function main(){
      try{
        statusEl.textContent = "読み込み中…";
        const res = await fetch("./data/revisions.json", { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        statusEl.textContent = `取得件数: ${data.length} 件`;

        listEl.innerHTML = data.map(item => `
          <div class="card">
            <div>
              <strong>${escapeHtml(item.lawName || "")}</strong>
              <span class="tag">${escapeHtml(item.stage || "")}</span>
            </div>
            <div style="margin-top:6px;">${escapeHtml(item.title || "")}</div>
            <div style="margin-top:6px;"><small>公布/日付: ${escapeHtml(item.promulgationDate || "")}</small></div>
            ${item.officialUrl ? `<div style="margin-top:8px;"><a href="${item.officialUrl}" target="_blank" rel="noreferrer">公式ページ</a></div>` : ""}
          </div>
        `).join("");
      }catch(e){
        statusEl.textContent = "読み込み失敗: " + e.message;
      }
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    main();
  </script>
</body>
</html>
